<!DOCTYPE html>
<html lang="en">
<head>
    <!-- -------------------------------------
        Roughly inspired by NeHe Tutorial 42
	Original:  http://nehe.gamedev.net/tutorial/multiple_viewports/20002/

    @author: rkwright@geofx.com
	-------------------------------------- -->
	<title>NEHE Lesson 41</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <!-- Set the viewport size to the screen size, so it will be displayed maximized, but unscaled. -->
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="../css/NEHE.css" />

    <!-- Include several libraries from THREE.js and the Scene class  -->
	<script src="../js/three.js" type="text/javascript"></script>
    <script src="../js/Detector.js" type="text/javascript"></script>
    <script src="../js/OrbitControls-Touch-Ortho.js" type="text/javascript"></script>
    <script src="../js/stats.js" type="text/javascript"></script>
    <script src="../js/gfx-scene.js" type="text/javascript"></script>
</head>
<body>

	<div style="position: absolute; top: 10px; left: 10px;color:white">
		<p></p>
	</div>

    <script type="text/javascript">
        // global vars (ick)
        var orthoCamera;
        var orthoControls;

        // allocate the Scene object, request orbitControls, some of 3D axes 10 units high and the stats
        var gfxScene = new GFX.Scene( {
            cameraPos : [0, 0, 200],
            controls:true,
            clearColor:0xc5e1e3,
            shadowMapEnabled : true,
            displayStats: true
        });

        // then initialize our demo's stuff
        initializeDemo();

        // Start the animation
        animateScene();

        /**
         * Initialize the Demo.
         */
        function initializeDemo() {

            addOrthoCamera();

            var wireMaterial = new THREE.MeshBasicMaterial( { color: 0x000000, wireframe: true, transparent: true } );
            var colorMaterial = new THREE.MeshPhongMaterial( { color: 0xff3333 } );
            var shape = THREE.SceneUtils.createMultiMaterialObject(
                new THREE.TorusKnotGeometry( 30, 6, 160, 10, 2, 5 ), [ colorMaterial, wireMaterial ] );
            shape.position.set(0, 0, 0);
            gfxScene.add( shape );
        }

        function addOrthoCamera() {

            var ORTHO_SIZE = 10;
            var cameraPos = new THREE.Vector3( 15, 10, 10 );
            var aspect = 0.5 * window.innerWidth / window.innerHeight;
            var w2 = ORTHO_SIZE * aspect / 2;
            var h2 = ORTHO_SIZE / 2;
            orthoCamera = new THREE.OrthographicCamera( -w2, w2, h2, -h2, 0.01, 1000);

            orthoCamera.updateProjectionMatrix();

            orthoCamera.position.set( cameraPos[0], cameraPos[1], cameraPos[2] );

            orthoCamera.lookAt(gfxScene.scene.position);

            orthoControls = new THREE.OrbitControls( orthoCamera, gfxScene.renderer.domElement );
        }

        /**
         * Animate the scene and call rendering.
         */
        function animateScene() {

            gfxScene.updateStats();

            // Tell the browser to call this function when page is visible
            requestAnimationFrame(animateScene);

            orthoControls.update();
            render();
        }

        function render() {
            var SCREEN_WIDTH = window.innerWidth;
            var SCREEN_HEIGHT = window.innerHeight;
            var HALF_WIDTH = SCREEN_WIDTH / 2;
            var SCREEN_ASPECT =  SCREEN_WIDTH / SCREEN_HEIGHT * 0.5;

            gfxScene.camera.aspect = SCREEN_ASPECT;
            orthoCamera.aspect   = SCREEN_ASPECT;
            gfxScene.camera.updateProjectionMatrix();
            orthoCamera.updateProjectionMatrix();

            // setViewport parameters:
            //  lower_left_x, lower_left_y, viewport_width, viewport_height

            gfxScene.renderer.setViewport( 0, 0, SCREEN_WIDTH, SCREEN_HEIGHT );
            gfxScene.renderer.clear();

            // left side
            gfxScene.renderer.setViewport( 1, 1,   0.5 * SCREEN_WIDTH - 2, SCREEN_HEIGHT - 2 );
            gfxScene.renderer.render( scene, gfxScene.camera );

            // right side
            gfxScene.renderer.setViewport( 0.5 * SCREEN_WIDTH + 1, 1,   0.5 * SCREEN_WIDTH - 2, SCREEN_HEIGHT - 2 );
            gfxScene.renderer.render( scene, orthoCamera );
        }
    </script>
</body>
</html>
